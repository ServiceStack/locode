<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Managed Files Uploads | Locode</title>
    <meta name="description" content="Config Desc">
    <link rel="stylesheet" href="/assets/style.0afdb665.css">
    <link rel="modulepreload" href="/assets/app.20eecff1.js">
    <link rel="modulepreload" href="/assets/docs_files.md.7a080d34.lean.js">
    
    <script src="/custom.js"></script>
  <meta name="twitter:title" content="Managed Files Uploads | Locode">
  <meta property="og:title" content="Managed Files Uploads | Locode">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="Locode, back to home" data-v-675d8756 data-v-cc01ef16><!----> Locode</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/docs/" data-v-b8818f8c>Docs <!----></a></div></div><!--]--><!----><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/ServiceStack/docs" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/docs/" data-v-b8818f8c>Docs <!----></a></div></div><!--]--><!----><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/ServiceStack/docs" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><p class="sidebar-link-item">Introduction</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/get-started">Getting Started</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/database-first">Database-First</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/code-first">Code-First</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">C# Development Model</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/declarative">Declarative Attributes</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/programmatic">Code Customizations</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/branding">Branding &amp; Appearance</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/formatters">Format Functions</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">Custom HTML/JS</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/custom">Overview</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/custom-forms">Custom Forms</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/custom-components">Custom Components</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">Features</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item active" href="/docs/files">File Management</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#basic-file-upload-example">Basic File Upload Example</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#using-file-upload-locations-in-apis">Using File Upload Locations in APIs</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#auto-form-uis">Auto Form UIs</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#managed-multi-file-upload-example">Managed Multi File Upload example</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#integrates-with-autoquery-crud">Integrates with AutoQuery CRUD</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#uploaded-file-metadata-populated-in-complex-type-properties">Uploaded File Metadata populated in Complex Type properties</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#uploading-files-from-c">Uploading Files from C#</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#using-httpclient-multipartformdatacontent">Using HttpClient MultipartFormDataContent</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#versatile-multi-part-content-type-apis">Versatile Multi Part Content Type APIs</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#uploading-files-from-js-typescript">Uploading Files from JS/TypeScript</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#substitutable-virtual-file-providers">Substitutable Virtual File Providers</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#memory-virtual-file-sources">Memory Virtual File Sources</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#configuring-database-first-apps">Configuring Database-First Apps</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/auditing">Auditing</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="managed-files-uploads" tabindex="-1">Managed Files Uploads <a class="header-anchor" href="#managed-files-uploads" aria-hidden="true">#</a></h1><p>The <code>FileUploadFeature</code> plugin is a high-level ServiceStack feature that allows you to configure multiple managed file upload locations within the same App that you can declaratively bind to different APIs to use.</p><p>Upload Locations can be configured to use any of the supported <a href="https://docs.servicestack.net/virtual-file-system#writable-virtual-file-system" target="_blank" rel="noopener noreferrer">Writable Virtual File Systems</a> including:</p><ul><li><code>FileSystemVirtualFiles</code> - Hard-disk or Network Files and Directories from a specified directory</li><li><code>S3VirtualFiles</code> - Files stored on Amazon&#39;s S3 Managed File Storage in <a href="https://github.com/ServiceStack/ServiceStack.Aws#s3virtualfiles" target="_blank" rel="noopener noreferrer">ServiceStack.Aws</a></li><li><code>AzureBlobVirtualFiles</code> - Files stored on Azure&#39;s Managed Blob Storage in <a href="https://github.com/ServiceStack/ServiceStack.Azure" target="_blank" rel="noopener noreferrer">ServiceStack.Azure</a></li><li><code>GistVirtualFiles</code> - Files persisted to a GitHub Gist</li><li><code>MemoryVirtualFiles</code> - Temporary Virtual Files and Folders that last for the lifetime of the AppHost</li></ul><p>With additional support can be added by <a href="https://docs.servicestack.net/virtual-file-system#implementing-a-new-virtual-file-system" target="_blank" rel="noopener noreferrer">Implementing a new Virtual File System</a>.</p><p>This is a generic feature that can be used by any ServiceStack HTTP API, which as it can be declaratively annotated on Request DTOs is especially useful in <a href="https://docs.servicestack.net/autoquery-crud" target="_blank" rel="noopener noreferrer">AutoQuery CRUD APIs</a> as it enables an easy way to populate a file path that can be stored along with your table row without the uploaded files living in the database itself taking up a lot of RDBMS resources and significantly impacting its performance.</p><h2 id="basic-file-upload-example" tabindex="-1">Basic File Upload Example <a class="header-anchor" href="#basic-file-upload-example" aria-hidden="true">#</a></h2><p>To demonstrate how to use the Managed File Uploads feature we&#39;ll look at handling the basic example of uploading files to publicly accessible <code>/wwwroot</code> folder location. This is what the <a href="https://talent.locode.dev" target="_blank" rel="noopener noreferrer">talent.locode.dev</a> Demo uses to handle profile image uploads for Contacts and Users in different locations in its <a href="https://github.com/NetCoreApps/TalentBlazor/blob/main/TalentBlazor/Configure.AppHost.cs" target="_blank" rel="noopener noreferrer">Configure.AppHost.cs</a>:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> wwwrootVfs <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetVirtualFileSource</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>FileSystemVirtualFiles<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">FilesUploadFeature</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">UploadLocation</span><span class="token punctuation">(</span><span class="token string">&quot;profiles&quot;</span><span class="token punctuation">,</span> wwwrootVfs<span class="token punctuation">,</span> <span class="token named-parameter punctuation">allowExtensions</span><span class="token punctuation">:</span>FileExt<span class="token punctuation">.</span>WebImages<span class="token punctuation">,</span>
        <span class="token named-parameter punctuation">resolvePath</span><span class="token punctuation">:</span> ctx <span class="token operator">=&gt;</span> <span class="token interpolation-string"><span class="token string">$&quot;/profiles/</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">ctx<span class="token punctuation">.</span>FileName</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">UploadLocation</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">,</span> wwwrootVfs<span class="token punctuation">,</span> <span class="token named-parameter punctuation">allowExtensions</span><span class="token punctuation">:</span>FileExt<span class="token punctuation">.</span>WebImages<span class="token punctuation">,</span>
        <span class="token named-parameter punctuation">resolvePath</span><span class="token punctuation">:</span> ctx <span class="token operator">=&gt;</span> <span class="token interpolation-string"><span class="token string">$&quot;/profiles/users/</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">ctx<span class="token punctuation">.</span>UserAuthId</span><span class="token punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">ctx<span class="token punctuation">.</span>FileExtension</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>As both locations are uploaded to the App&#39;s <code>/wwwroot</code> folder they&#39;ll be immediately accessible after they&#39;re uploaded. Contact profile images are saved using their uploaded FileName whilst User profiles are saved in a predictable location against their User Id and uploaded File Extension type.</p><p>The only default restriction placed on File Uploads is that they can only be performed by Authenticated Users. Each <code>UploadLocation</code> is able to use the several configuration options available to further restrict file uploads by file type, count, size, number of uploads or a custom validation function. In this instance Talent Blazor is restricting uploads in <code>allowExtensions</code> to only Images supported by Browsers, which is a server validation that also gets propagated to the client to limit the user to only be able to select from the server-configured file extensions:</p><p><img src="/assets/upload-accept.8ae2b759.png" alt=""></p><p>To simplify configuration <a href="https://github.com/ServiceStack/ServiceStack/blob/main/ServiceStack/src/ServiceStack/FilesUploadFeature.cs" target="_blank" rel="noopener noreferrer">we&#39;ve included</a> a number of pre-configured file extensions for different file types.</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">FileExt</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> WebImages <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;png&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jpg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jpeg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;gif&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;svg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;webp&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> BinaryImages <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;png&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jpg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jpeg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;gif&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bmp&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tif&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tiff&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;webp&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ai&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;psd&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ps&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> Images <span class="token operator">=</span> WebImages<span class="token punctuation">.</span><span class="token function">CombineDistinct</span><span class="token punctuation">(</span>BinaryImages<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> WebVideos <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;avi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;m4v&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;mov&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;mp4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;mpg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;mpeg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;wmv&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;webm&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> WebAudios <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;mp3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;mpa&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ogg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;wav&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;wma&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;mid&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;webm&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> BinaryDocuments <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;doc&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;docx&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pdf&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;rtf&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> TextDocuments <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;tex&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;md&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;rst&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> Spreadsheets <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;xls&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;xlsm&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;xlsx&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ods&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;csv&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;txv&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> Presentations <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;odp&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pps&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ppt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pptx&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> AllDocuments <span class="token operator">=</span> BinaryDocuments<span class="token punctuation">.</span><span class="token function">CombineDistinct</span><span class="token punctuation">(</span>TextDocuments<span class="token punctuation">,</span> Presentations<span class="token punctuation">,</span> Spreadsheets<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> WebFormats <span class="token operator">=</span> WebImages<span class="token punctuation">.</span><span class="token function">CombineDistinct</span><span class="token punctuation">(</span>WebVideos<span class="token punctuation">,</span> WebAudios<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="using-file-upload-locations-in-apis" tabindex="-1">Using File Upload Locations in APIs <a class="header-anchor" href="#using-file-upload-locations-in-apis" aria-hidden="true">#</a></h3><p>With just the above configuration we can now use them in our APIs, which Talent Blazor does in its <code>CreateContact</code> and <code>UpdateContact</code> <a href="https://docs.servicestack.net/autoquery-crud" target="_blank" rel="noopener noreferrer">CRUD APIs</a> to handle uploading a contact profiles image when they&#39;re Created and Updated:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CreateContact</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ICreateDb<span class="token punctuation">&lt;</span>Contact<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>Contact<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateNotEmpty</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> FirstName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateNotEmpty</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> LastName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
    
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Input</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Type <span class="token operator">=</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">)</span></span><span class="token punctuation">,</span> <span class="token class-name">UploadTo</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;profiles&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> ProfileUrl <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> SalaryExpectation <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateNotEmpty</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> JobType <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> AvailabilityWeeks <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">EmploymentType</span> PreferredWorkType <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateNotEmpty</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> PreferredLocation <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateNotEmpty</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Email <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> Phone <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UpdateContact</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IPatchDb<span class="token punctuation">&lt;</span>Contact<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>Contact<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateNotEmpty</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> FirstName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateNotEmpty</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> LastName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Input</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Type <span class="token operator">=</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">)</span></span><span class="token punctuation">,</span> <span class="token class-name">UploadTo</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;profiles&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> ProfileUrl <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> SalaryExpectation <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateNotEmpty</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> JobType <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> AvailabilityWeeks <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">EmploymentType<span class="token punctuation">?</span></span> PreferredWorkType <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> PreferredLocation <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateNotEmpty</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> Email <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> Phone <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Input</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Type <span class="token operator">=</span> <span class="token string">&quot;textarea&quot;</span><span class="token punctuation">)</span></span><span class="token punctuation">,</span> <span class="token class-name">FieldCss</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Field <span class="token operator">=</span> <span class="token string">&quot;col-span-12 text-center&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> About <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Only the <code>[UploadTo(location)]</code> attribute is required to instruct the API to use the specified Upload Location to handle the File Upload. For successful uploads the Uploaded HTTP File will be saved to the configured file path which it populates on the <code>ProfileUrl</code> property which from that point is treated as a normal <code>string</code> property that is validated and stored along with the rest of the DTO properties in the <code>Contact</code> Table.</p><h3 id="auto-form-uis" tabindex="-1">Auto Form UIs <a class="header-anchor" href="#auto-form-uis" aria-hidden="true">#</a></h3><p>In API Explorer &amp; Locode Apps you&#39;ll want to pair this together with <code>[Input(Type=&quot;file&quot;)]</code> to instruct the Auto Form UI to use its File Upload control to handle updating this property, which looks like:</p><p><a href="https://talent.locode.dev/locode/QueryContacts?edit=1" target="_blank" rel="noopener noreferrer"><img src="/assets/update-contact.7cc59840.png" alt=""></a></p><h2 id="managed-multi-file-upload-example" tabindex="-1">Managed Multi File Upload example <a class="header-anchor" href="#managed-multi-file-upload-example" aria-hidden="true">#</a></h2><p>In addition to managing image profiles for its Users and Contacts, Talent Blazor also uses Managed File Uploads to handle accepting an Applicant&#39;s Job Application attachments. We need a more <a href="https://github.com/NetCoreApps/FileBlazor/blob/main/FileBlazor/Configure.AppHost.cs" target="_blank" rel="noopener noreferrer">advanced configuration</a> to handle this use-case where we want to:</p><ul><li>Save uploaded Applications to non-servable <strong>~/App_Data</strong> folder</li><li>Limit Job Applications to a maximum of <strong>3 attachments</strong></li><li>Limit Max Upload size to <strong>10mb</strong></li><li>Allow <strong>non-authenticated Users</strong> to upload &amp; download their attachments</li></ul><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> appDataVfs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileSystemVirtualFiles</span><span class="token punctuation">(</span>ContentRootDirectory<span class="token punctuation">.</span>RealPath<span class="token punctuation">.</span><span class="token function">CombineWith</span><span class="token punctuation">(</span><span class="token string">&quot;App_Data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">FilesUploadFeature</span><span class="token punctuation">(</span>
    <span class="token comment">//...</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">UploadLocation</span><span class="token punctuation">(</span><span class="token string">&quot;applications&quot;</span><span class="token punctuation">,</span> appDataVfs<span class="token punctuation">,</span> <span class="token named-parameter punctuation">maxFileCount</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">maxFileBytes</span><span class="token punctuation">:</span> <span class="token number">10_000_000</span><span class="token punctuation">,</span>
        <span class="token named-parameter punctuation">resolvePath</span><span class="token punctuation">:</span> ctx <span class="token operator">=&gt;</span> ctx<span class="token punctuation">.</span><span class="token function">GetLocationPath</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>Dto <span class="token keyword">is</span> <span class="token class-name">CreateJobApplication</span> create
            <span class="token punctuation">?</span> <span class="token interpolation-string"><span class="token string">$&quot;jobapp/</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">create<span class="token punctuation">.</span>JobId</span><span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">create<span class="token punctuation">.</span>ContactId</span><span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">ctx<span class="token punctuation">.</span>FileName</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
            <span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">$&quot;app/</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">ctx<span class="token punctuation">.</span>Dto<span class="token punctuation">.</span><span class="token function">GetId</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token interpolation-string"><span class="token string">$&quot;/</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">ctx<span class="token punctuation">.</span>DateSegment</span><span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">ctx<span class="token punctuation">.</span>FileName</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token named-parameter punctuation">readAccessRole</span><span class="token punctuation">:</span> RoleNames<span class="token punctuation">.</span>AllowAnon<span class="token punctuation">,</span> <span class="token named-parameter punctuation">writeAccessRole</span><span class="token punctuation">:</span> RoleNames<span class="token punctuation">.</span>AllowAnon<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In this case instead of resolving a relative path from <code>/wwwroot</code> it uses <code>ctx.GetLocationPath()</code> to resolve to a managed file location whose access is managed by <code>FilesUploadFeature</code> File Management APIs:</p><table><thead><tr><th>API</th><th>Route</th><th>Description</th></tr></thead><tbody><tr><td><code>StoreFileUpload</code></td><td><strong>POST</strong> <code>/uploads/{Name}</code></td><td>Upload files to the specified managed location</td></tr><tr><td><code>GetFileUpload</code></td><td><strong>GET</strong> <code>/uploads/{Name}/{Path}</code></td><td>Download file from the specified managed location</td></tr><tr><td><code>ReplaceFileUpload</code></td><td><strong>PUT</strong> <code>/uploads/{Name}/{Path}</code></td><td>Overwrite file at the specified managed location</td></tr><tr><td><code>DeleteFileUpload</code></td><td><strong>DELETE</strong> <code>/uploads/{Name}/{Path}</code></td><td>Delete file at the specified managed location</td></tr></tbody></table><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><code>/uploads</code> is the overridable default <code>BasePath</code> for <code>FilesUploadFeature</code> managed File APIs</p></div><p>With everything configured we can now start accepting attachments with our Job Applications by adding <code>[Input(Type=&quot;file&quot;), UploadTo(&quot;applications&quot;)]</code> to the property where we want the Uploaded File metadata populated to when submitting and updating Job Applications:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CreateJobApplication</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ICreateDb<span class="token punctuation">&lt;</span>JobApplication<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>JobApplication<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateGreaterThan</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> JobId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateGreaterThan</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> ContactId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> AppliedDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">JobApplicationStatus</span> ApplicationStatus <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Input</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Type<span class="token operator">=</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">)</span></span><span class="token punctuation">,</span> <span class="token class-name">UploadTo</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;applications&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>JobApplicationAttachment<span class="token punctuation">&gt;</span></span> Attachments <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UpdateJobApplication</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IPatchDb<span class="token punctuation">&lt;</span>JobApplication<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>JobApplication<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> JobId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> ContactId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime<span class="token punctuation">?</span></span> AppliedDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">JobApplicationStatus</span> ApplicationStatus <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Input</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Type<span class="token operator">=</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">)</span></span><span class="token punctuation">,</span> <span class="token class-name">UploadTo</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;applications&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>JobApplicationAttachment<span class="token punctuation">&gt;</span><span class="token punctuation">?</span></span> Attachments <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This is all that&#39;s needed to configure our Create CRUD Services to handle multiple file uploads in Locode &amp; API Explorer:</p><p><img src="/assets/create-job-application.a02a0c08.png" alt=""></p><p>Where the File Input behaves as just another Input control with contextual validation errors displayed when it exceeds any of the configured file restrictions on its Upload Location, e.g:</p><p><img src="/assets/create-job-application-failed.622ee9c9.png" alt=""></p><p>After a successful submission the attachments are uploaded to the configured managed location path which is then used to access the file in the Update Job Application Form UI:</p><p><img src="/assets/update-job-application.e8216dbf.png" alt=""></p><h3 id="integrates-with-autoquery-crud" tabindex="-1">Integrates with AutoQuery CRUD <a class="header-anchor" href="#integrates-with-autoquery-crud" aria-hidden="true">#</a></h3><p>This is another example of how well this generic feature works with the rest of ServiceStack, where without any implementation logic the AutoQuery CRUD API is able to populate a <strong>1 to Many</strong> table relationship to capture the metadata of each uploaded file because the <code>Attachments</code> Request DTO property maps to a <code>[Reference]</code><a href="https://docs.servicestack.net/ormlite/reference-support" target="_blank" rel="noopener noreferrer">POCO Reference</a> property which automatically populates Foreign Key Reference properties in CRUD APIs.</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JobApplication</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">AuditBase</span></span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Reference</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>JobApplicationAttachment<span class="token punctuation">&gt;</span></span> Attachments <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JobApplicationAttachment</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoIncrement</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">References</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">JobApplication</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> JobApplicationId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> FileName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Format</span><span class="token attribute-arguments"><span class="token punctuation">(</span>FormatMethods<span class="token punctuation">.</span>Attachment<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> FilePath <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> ContentType <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Format</span><span class="token attribute-arguments"><span class="token punctuation">(</span>FormatMethods<span class="token punctuation">.</span>Bytes<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">long</span></span> ContentLength <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="uploaded-file-metadata-populated-in-complex-type-properties" tabindex="-1">Uploaded File Metadata populated in Complex Type properties <a class="header-anchor" href="#uploaded-file-metadata-populated-in-complex-type-properties" aria-hidden="true">#</a></h3><p>This also shows that <code>[UploadTo]</code> can either be applied to a <code>string</code> property where it&#39;s just populated with the path the file is uploaded to, or it could contain a <strong>complex type</strong> where any matching properties are populated with metadata of the uploaded file:</p><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>FilePath</td><td>The UploadLocation path where the file is uploaded to</td></tr><tr><td>Name</td><td>The form field name from the Content-Disposition header</td></tr><tr><td>FileName</td><td>The file name of the uploaded file</td></tr><tr><td>ContentLength</td><td>The size in bytes of the uploaded file</td></tr><tr><td>ContentType</td><td>The Content-Type of the uploaded file</td></tr></tbody></table><p>In addition, it also supports <code>List&lt;string&gt;</code> or <code>List&lt;T&gt;</code> complex types for handling multiple file uploads as in this case.</p><p>All these features work together to achieve our desired result of populating submitted applications in the <code>JobApplicationAttachment</code> joined table, so their metadata can be browsed, queried and navigated like any other related data without file system access and without their contents consuming RDBMS resources:</p><p><img src="/assets/job-application-attachments.22b9dde4.png" alt=""></p><h2 id="uploading-files-from-c" tabindex="-1">Uploading Files from C# <a class="header-anchor" href="#uploading-files-from-c" aria-hidden="true">#</a></h2><p>Whilst Locode gives us instant utility that lets us start submitting file attachments with any AutoQuery CRUD DTO, as the feature just uses standard <a href="https://www.ietf.org/rfc/rfc2388.txt" target="_blank" rel="noopener noreferrer">HTTP multipart/form-data</a> we can use the existing <a href="https://docs.servicestack.net/csharp-client" target="_blank" rel="noopener noreferrer">Service Client APIs</a> for uploading files as demonstrated in Talent Blazor&#39;s <a href="https://github.com/NetCoreApps/TalentBlazor/blob/main/TalentBlazor.Tests/FileUploadTests.cs" target="_blank" rel="noopener noreferrer">FileUploadTests.cs</a> which uploads a single attachment when creating a Contact with a Profile Image and multiple file attachments when submitting a Job Application:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> profileImg <span class="token operator">=</span> <span class="token keyword">await</span> ProfileImageUrl<span class="token punctuation">.</span><span class="token function">GetStreamFromUrlAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> contact <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">PostFileWithRequestAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Contact<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>profileImg<span class="token punctuation">,</span> <span class="token string">&quot;cody-fisher.png&quot;</span><span class="token punctuation">,</span> 
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CreateContact</span>
    <span class="token punctuation">{</span>
        FirstName <span class="token operator">=</span> <span class="token string">&quot;Cody&quot;</span><span class="token punctuation">,</span>
        LastName <span class="token operator">=</span> <span class="token string">&quot;Fisher&quot;</span><span class="token punctuation">,</span>
        Email <span class="token operator">=</span> <span class="token string">&quot;cody.fisher@gmail.com&quot;</span><span class="token punctuation">,</span>
        JobType <span class="token operator">=</span> <span class="token string">&quot;Security&quot;</span><span class="token punctuation">,</span>
        PreferredLocation <span class="token operator">=</span> <span class="token string">&quot;Remote&quot;</span><span class="token punctuation">,</span>
        PreferredWorkType <span class="token operator">=</span> EmploymentType<span class="token punctuation">.</span>FullTime<span class="token punctuation">,</span>
        AvailabilityWeeks <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
        SalaryExpectation <span class="token operator">=</span> <span class="token number">100_000</span><span class="token punctuation">,</span>
        About <span class="token operator">=</span> <span class="token string">&quot;Lead Security Associate&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">fieldName</span><span class="token punctuation">:</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>CreateContact<span class="token punctuation">.</span>ProfileUrl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// contact.ProfileUrl = /profiles/cody-fisher.png</span>

<span class="token class-name"><span class="token keyword">var</span></span> uploadedImage <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span>BaseUri<span class="token punctuation">.</span><span class="token function">CombineWith</span><span class="token punctuation">(</span>contact<span class="token punctuation">.</span>ProfileUrl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetStreamFromUrlAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> coverLetter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileInfo</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">AppData</span><span class="token punctuation">}</span></span><span class="token string">/sample_coverletter.pdf&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> resume <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileInfo</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">AppData</span><span class="token punctuation">}</span></span><span class="token string">/sample_resume.pdf&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> attachmentsField <span class="token operator">=</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>CreateJobApplication<span class="token punctuation">.</span>Attachments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> uploadAttachments <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">UploadFile<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">new</span><span class="token punctuation">(</span>coverLetter<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> coverLetter<span class="token punctuation">.</span><span class="token function">OpenRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> attachmentsField<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span><span class="token punctuation">(</span>resume<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> coverLetter<span class="token punctuation">.</span><span class="token function">OpenRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> attachmentsField<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span><span class="token punctuation">(</span>contact<span class="token punctuation">.</span>ProfileUrl<span class="token punctuation">.</span><span class="token function">LastRightPart</span><span class="token punctuation">(</span><span class="token char">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> uploadedImage<span class="token punctuation">,</span> attachmentsField<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> jobApp <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">PostFilesWithRequestAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>JobApplication<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">CreateJobApplication</span> <span class="token punctuation">{</span>
        JobId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
        AppliedDate <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>UtcNow<span class="token punctuation">,</span>
        ContactId <span class="token operator">=</span> contact<span class="token punctuation">.</span>Id<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> uploadAttachments<span class="token punctuation">)</span><span class="token punctuation">;</span>

uploadAttachments<span class="token punctuation">.</span><span class="token function">Each</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Stream<span class="token punctuation">.</span><span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This example also shows that as APIs accept submitting files from any <code>Stream</code> that we&#39;re able to source from anywhere, including the HTTP Response stream of a Remote URI or files from a local hard drive.</p><h3 id="using-httpclient-multipartformdatacontent" tabindex="-1">Using HttpClient MultipartFormDataContent <a class="header-anchor" href="#using-httpclient-multipartformdatacontent" aria-hidden="true">#</a></h3><p>The introduction of <a href="https://docs.servicestack.net/csharp-client#jsonapiclient" target="_blank" rel="noopener noreferrer">.NET 6+ JsonApiClient</a> lets us provide a more flexible approach by utilizing <code>MultipartFormDataContent()</code> which we&#39;ve enhanced with high-level extension methods to enable a Fluent API for constructing our custom API Request populated from multiple sources by using the <code>ApiFormAsync</code> method:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> profileImg <span class="token operator">=</span> <span class="token keyword">await</span> ProfileImageUrl<span class="token punctuation">.</span><span class="token function">GetStreamFromUrlAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> createContact <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MultipartFormDataContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddParams</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">CreateContact</span>
    <span class="token punctuation">{</span>
        FirstName <span class="token operator">=</span> <span class="token string">&quot;Cody&quot;</span><span class="token punctuation">,</span>
        LastName <span class="token operator">=</span> <span class="token string">&quot;Fisher&quot;</span><span class="token punctuation">,</span>
        Email <span class="token operator">=</span> <span class="token string">&quot;cody.fisher@gmail.com&quot;</span><span class="token punctuation">,</span>
        JobType <span class="token operator">=</span> <span class="token string">&quot;Security&quot;</span><span class="token punctuation">,</span>
        PreferredLocation <span class="token operator">=</span> <span class="token string">&quot;Remote&quot;</span><span class="token punctuation">,</span>
        PreferredWorkType <span class="token operator">=</span> EmploymentType<span class="token punctuation">.</span>FullTime<span class="token punctuation">,</span>
        AvailabilityWeeks <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
        SalaryExpectation <span class="token operator">=</span> <span class="token number">100_000</span><span class="token punctuation">,</span>
        About <span class="token operator">=</span> <span class="token string">&quot;Lead Security Associate&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddFile</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>CreateContact<span class="token punctuation">.</span>ProfileUrl<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;cody-fisher.png&quot;</span><span class="token punctuation">,</span> profileImg<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> contactApi <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ApiFormAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Contact<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">CreateContact</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToApiUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> createContact<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// contactApi.Succeeded = true</span>
<span class="token class-name"><span class="token keyword">var</span></span> contact <span class="token operator">=</span> contactApi<span class="token punctuation">.</span>Response<span class="token operator">!</span><span class="token punctuation">;</span>
<span class="token comment">// contact.ProfileUrl   = /profiles/cody-fisher.png</span>

<span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> uploadedImage <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span>BaseUri<span class="token punctuation">.</span><span class="token function">CombineWith</span><span class="token punctuation">(</span>contact<span class="token punctuation">.</span>ProfileUrl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetStreamFromUrlAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> coverLetter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileInfo</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">AppData</span><span class="token punctuation">}</span></span><span class="token string">/sample_coverletter.pdf&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> resume <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileInfo</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">AppData</span><span class="token punctuation">}</span></span><span class="token string">/sample_resume.pdf&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> attachmentsField <span class="token operator">=</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>CreateJobApplication<span class="token punctuation">.</span>Attachments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> createJobApp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MultipartFormDataContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddParams</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">CreateJobApplication</span> <span class="token punctuation">{</span>
        JobId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
        AppliedDate <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>UtcNow<span class="token punctuation">,</span>
        ContactId <span class="token operator">=</span> contact<span class="token punctuation">.</span>Id<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddFile</span><span class="token punctuation">(</span>attachmentsField<span class="token punctuation">,</span> coverLetter<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddFile</span><span class="token punctuation">(</span>attachmentsField<span class="token punctuation">,</span> resume<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddFile</span><span class="token punctuation">(</span>attachmentsField<span class="token punctuation">,</span> contact<span class="token punctuation">.</span>ProfileUrl<span class="token punctuation">.</span><span class="token function">LastRightPart</span><span class="token punctuation">(</span><span class="token char">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> uploadedImage<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> jobAppApi <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ApiFormAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>JobApplication<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>
    <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">CreateJobApplication</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToApiUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> createJobApp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// jobAppApi.Succeeded = true</span>
<span class="token class-name"><span class="token keyword">var</span></span> jobApp <span class="token operator">=</span> jobAppApi<span class="token punctuation">.</span>Response<span class="token operator">!</span><span class="token punctuation">;</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>All <code>JsonApiClient</code> Async APIs also have <a href="https://docs.servicestack.net/csharp-client#safe-sync-httpclient-apis" target="_blank" rel="noopener noreferrer">safe sync equivalents</a> when access outside an async method is needed</p></div><h3 id="versatile-multi-part-content-type-apis" tabindex="-1">Versatile Multi Part Content Type APIs <a class="header-anchor" href="#versatile-multi-part-content-type-apis" aria-hidden="true">#</a></h3><p>The <a href="https://github.com/ServiceStack/ServiceStack/blob/main/ServiceStack/tests/ServiceStack.WebHost.Endpoints.Tests/AutoQueryCrudTests.References.cs" target="_blank" rel="noopener noreferrer">AutoQueryCrudTests.References.cs</a> also showcases how we can take advantage of <code>MultipartFormDataContent</code> to construct custom requests sent using a combination of different Content Type sources, including single and multiple file attachments within a single request:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MultipartRequest</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IPost</span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>MultipartRequest<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> String <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    
    <span class="token comment">// Complex types sent as JSV by default</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Contact</span> Contact <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">MultiPartField</span><span class="token attribute-arguments"><span class="token punctuation">(</span>MimeTypes<span class="token punctuation">.</span>Json<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">PhoneScreen</span> PhoneScreen <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">MultiPartField</span><span class="token attribute-arguments"><span class="token punctuation">(</span>MimeTypes<span class="token punctuation">.</span>Csv<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Contact<span class="token punctuation">&gt;</span></span> Contacts <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">UploadTo</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;profiles&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> ProfileUrl <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">UploadTo</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;applications&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>UploadedFile<span class="token punctuation">&gt;</span></span> UploadedFiles <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre></div><p><a href="https://docs.servicestack.net/serialization-deserialization" target="_blank" rel="noopener noreferrer">Complex types are sent using JSV</a> by default which is a more human &amp; wrist-friendly and more efficient format than JSON, however we could also take advantage of the flexibility in HTTP <strong>multipart/form-data</strong> requests to construct an HTTP API Request utilizing multiple Content-Type&#39;s optimized for the data we&#39;re sending, e.g:</p><ul><li>JSON/JSV more optimal for hierarchical graph data</li><li>CSV more optimal for sending tabular data</li><li>File Uploads are more optimal for sending large files</li></ul><p>To facilitate this in our Server APIs we can use <code>[MultiPartField]</code> attribute to instruct ServiceStack which registered serializer it should use to deserialize the form-data payload, whilst we can continue using the generic <code>[UploadTo]</code> attribute in normal APIs to handle our File Uploads and populate the Request DTO with the uploaded file metadata.</p><p>Our <code>MultipartFormDataContent</code> extension methods simplifies our client logic by allowing us to easily populate this custom request in a single construction Fluent expression:</p><div class="language-csharp"><pre><code><span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> content <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MultipartFormDataContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddParam</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>MultipartRequest<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddParam</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>MultipartRequest<span class="token punctuation">.</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddParam</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>MultipartRequest<span class="token punctuation">.</span>Contact<span class="token punctuation">)</span><span class="token punctuation">,</span> 
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Contact</span> <span class="token punctuation">{</span> Id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> FirstName <span class="token operator">=</span> <span class="token string">&quot;First&quot;</span><span class="token punctuation">,</span> LastName <span class="token operator">=</span> <span class="token string">&quot;Last&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddJsonParam</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>MultipartRequest<span class="token punctuation">.</span>PhoneScreen<span class="token punctuation">)</span><span class="token punctuation">,</span> 
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PhoneScreen</span> <span class="token punctuation">{</span> Id <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> JobApplicationId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> Notes <span class="token operator">=</span> <span class="token string">&quot;The Notes&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddCsvParam</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>MultipartRequest<span class="token punctuation">.</span>Contacts<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Contact</span> <span class="token punctuation">{</span> Id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> FirstName <span class="token operator">=</span> <span class="token string">&quot;First2&quot;</span><span class="token punctuation">,</span> LastName <span class="token operator">=</span> <span class="token string">&quot;Last2&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Contact</span> <span class="token punctuation">{</span> Id <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> FirstName <span class="token operator">=</span> <span class="token string">&quot;First3&quot;</span><span class="token punctuation">,</span> LastName <span class="token operator">=</span> <span class="token string">&quot;Last3&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddFile</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>MultipartRequest<span class="token punctuation">.</span>ProfileUrl<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;profile.txt&quot;</span><span class="token punctuation">,</span> file1Stream<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddFile</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>MultipartRequest<span class="token punctuation">.</span>UploadedFiles<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;uploadedFiles1.txt&quot;</span><span class="token punctuation">,</span> file2Stream<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddFile</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>MultipartRequest<span class="token punctuation">.</span>UploadedFiles<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;uploadedFiles2.txt&quot;</span><span class="token punctuation">,</span> file3Stream<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> api <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ApiFormAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MultipartRequest<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">MultipartRequest</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToApiUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>api<span class="token punctuation">.</span>Succeeded<span class="token punctuation">)</span> api<span class="token punctuation">.</span>Error<span class="token punctuation">.</span><span class="token function">PrintDump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="uploading-files-from-js-typescript" tabindex="-1">Uploading Files from JS/TypeScript <a class="header-anchor" href="#uploading-files-from-js-typescript" aria-hidden="true">#</a></h2><p>Similarly, we can populate custom requests by either programmatically constructing the <a href="https://developer.mozilla.org/en-US/docs/Web/API/FormData" target="_blank" rel="noopener noreferrer">FormData</a> object which also benefits from native integration in browsers where it can be populated directly from an HTML Form:</p><div class="language-ts"><pre><code><span class="token keyword">let</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonServiceClient</span><span class="token punctuation">(</span>BaseUrl<span class="token punctuation">)</span>
<span class="token keyword">let</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>forms<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> api <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">apiForm</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MultipartRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> formData<span class="token punctuation">)</span>
</code></pre></div><p>Where <code>apiForm</code> can be used to submit <code>FormData</code> requests for normal API Requests, or <code>apiFormVoid</code> for <code>IReturnVoid</code> API requests.</p><h2 id="substitutable-virtual-file-providers" tabindex="-1">Substitutable Virtual File Providers <a class="header-anchor" href="#substitutable-virtual-file-providers" aria-hidden="true">#</a></h2><p>We&#39;ve created the <a href="https://file.locode.dev" target="_blank" rel="noopener noreferrer">File Blazor Demo</a> to further demonstrate the versatility of the <code>FilesUploadFeature</code> to seamlessly manage uploading files to multiple different locations using different providers but still able to utilize the same custom configuration and validation in its <a href="https://github.com/NetCoreApps/FileBlazor/blob/main/FileBlazor/Configure.AppHost.cs" target="_blank" rel="noopener noreferrer">Configure.AppHost.cs</a>:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> appFs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileSystemVirtualFiles</span><span class="token punctuation">(</span>ContentRootDirectory<span class="token punctuation">.</span>RealPath<span class="token punctuation">.</span><span class="token function">CombineWith</span><span class="token punctuation">(</span><span class="token string">&quot;App_Data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AssertDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> s3Client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AmazonS3Client</span><span class="token punctuation">(</span>awsAccessKeyId<span class="token punctuation">,</span> awsSecretAccessKey<span class="token punctuation">,</span> RegionEndpoint<span class="token punctuation">.</span>USEast1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> s3DataVfs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">S3VirtualFiles</span><span class="token punctuation">(</span>s3Client<span class="token punctuation">,</span> <span class="token string">&quot;file-blazor-demo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> azureBlobVfs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AzureBlobVirtualFiles</span><span class="token punctuation">(</span>azureBlobConnString<span class="token punctuation">,</span> <span class="token string">&quot;file-blazor-demo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">FilesUploadFeature</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">UploadLocation</span><span class="token punctuation">(</span><span class="token string">&quot;azure&quot;</span><span class="token punctuation">,</span> azureBlobVfs<span class="token punctuation">,</span>
        <span class="token named-parameter punctuation">readAccessRole</span><span class="token punctuation">:</span> RoleNames<span class="token punctuation">.</span>AllowAnon<span class="token punctuation">,</span> <span class="token named-parameter punctuation">resolvePath</span><span class="token punctuation">:</span> ResolveUploadPath<span class="token punctuation">,</span>
        <span class="token named-parameter punctuation">validateUpload</span><span class="token punctuation">:</span> ValidateUpload<span class="token punctuation">,</span> <span class="token named-parameter punctuation">validateDownload</span><span class="token punctuation">:</span> ValidateDownload<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">UploadLocation</span><span class="token punctuation">(</span><span class="token string">&quot;s3&quot;</span><span class="token punctuation">,</span> s3DataVfs<span class="token punctuation">,</span>
        <span class="token named-parameter punctuation">readAccessRole</span><span class="token punctuation">:</span> RoleNames<span class="token punctuation">.</span>AllowAnon<span class="token punctuation">,</span> <span class="token named-parameter punctuation">resolvePath</span><span class="token punctuation">:</span> ResolveUploadPath<span class="token punctuation">,</span>
        <span class="token named-parameter punctuation">validateUpload</span><span class="token punctuation">:</span> ValidateUpload<span class="token punctuation">,</span> <span class="token named-parameter punctuation">validateDownload</span><span class="token punctuation">:</span> ValidateDownload<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">UploadLocation</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">,</span> appFs<span class="token punctuation">,</span>
        <span class="token named-parameter punctuation">readAccessRole</span><span class="token punctuation">:</span> RoleNames<span class="token punctuation">.</span>AllowAnon<span class="token punctuation">,</span> <span class="token named-parameter punctuation">resolvePath</span><span class="token punctuation">:</span> ResolveUploadPath<span class="token punctuation">,</span>
        <span class="token named-parameter punctuation">validateUpload</span><span class="token punctuation">:</span> ValidateUpload<span class="token punctuation">,</span> <span class="token named-parameter punctuation">validateDownload</span><span class="token punctuation">:</span> ValidateDownload<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">ResolveUploadPath</span><span class="token punctuation">(</span><span class="token class-name">FilesUploadContext</span> ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    ctx<span class="token punctuation">.</span>Dto <span class="token keyword">is</span> <span class="token class-name">IAppFile</span> <span class="token punctuation">{</span> FileAccessType<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> createFile
        <span class="token punctuation">?</span> createFile<span class="token punctuation">.</span>FileAccessType <span class="token operator">!=</span> <span class="token return-type class-name">FileAccessType<span class="token punctuation">.</span>Private
            <span class="token punctuation">?</span></span> ctx<span class="token punctuation">.</span><span class="token function">GetLocationPath</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;/</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">createFile<span class="token punctuation">.</span>FileAccessType</span><span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">ctx<span class="token punctuation">.</span>FileName</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">:</span> ctx<span class="token punctuation">.</span><span class="token function">GetLocationPath</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;/</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">createFile<span class="token punctuation">.</span>FileAccessType</span><span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">ctx<span class="token punctuation">.</span>UserAuthId</span><span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">ctx<span class="token punctuation">.</span>FileName</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">:</span> <span class="token keyword">throw</span> HttpError<span class="token punctuation">.</span><span class="token function">BadRequest</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid file creation request.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ValidateUpload</span><span class="token punctuation">(</span><span class="token class-name">IRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">IHttpFile</span> file<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>Dto <span class="token keyword">is</span> <span class="token class-name">IAppFile</span> createFile<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> accessType <span class="token operator">=</span> createFile<span class="token punctuation">.</span>FileAccessType<span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> ext <span class="token operator">=</span> file<span class="token punctuation">.</span>FileName<span class="token punctuation">.</span><span class="token function">LastRightPart</span><span class="token punctuation">(</span><span class="token char">&#39;.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>accessType <span class="token operator">==</span> FileAccessType<span class="token punctuation">.</span>Gallery <span class="token operator">&amp;&amp;</span> ext <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> FileExt<span class="token punctuation">.</span>Images<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>ext<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;Supported file extensions: {0}&quot;</span><span class="token punctuation">.</span><span class="token function">LocalizeFmt</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> 
                <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">&quot;, &quot;</span><span class="token punctuation">,</span> FileExt<span class="token punctuation">.</span>Images<span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> <span class="token char">&#39;.&#39;</span> <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span>FileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpError</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid request.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//...</span>
</code></pre></div><h3 id="memory-virtual-file-sources" tabindex="-1">Memory Virtual File Sources <a class="header-anchor" href="#memory-virtual-file-sources" aria-hidden="true">#</a></h3><p>ServiceStack AppHost&#39;s are configured with an empty Memory VFS which can be used to transiently prepopulate App files from external sources on Startup or maintain temporary working files with the same lifetime of the App without needing to persist to disk.</p><p>They&#39;re also a great solution for Integration Testing managed file access without creating any persistent artifacts as done in <a href="https://github.com/ServiceStack/ServiceStack/blob/main/ServiceStack/tests/ServiceStack.WebHost.Endpoints.Tests/AutoQueryCrudTests.References.cs" target="_blank" rel="noopener noreferrer">AutoQueryCrudTests.References.cs</a></p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> memFs <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetVirtualFileSource</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MemoryVirtualFiles<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">FilesUploadFeature</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">UploadLocation</span><span class="token punctuation">(</span><span class="token string">&quot;profiles&quot;</span><span class="token punctuation">,</span> memFs<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">UploadLocation</span><span class="token punctuation">(</span><span class="token string">&quot;applications&quot;</span><span class="token punctuation">,</span> memFs<span class="token punctuation">,</span> <span class="token named-parameter punctuation">maxFileCount</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">maxFileBytes</span><span class="token punctuation">:</span> <span class="token number">10_000_000</span><span class="token punctuation">,</span>
        <span class="token named-parameter punctuation">resolvePath</span><span class="token punctuation">:</span> ctx <span class="token operator">=&gt;</span> ctx<span class="token punctuation">.</span><span class="token function">GetLocationPath</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>Dto <span class="token keyword">is</span> <span class="token class-name">CreateJobApplication</span> create
            <span class="token punctuation">?</span> <span class="token interpolation-string"><span class="token string">$&quot;job/</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">create<span class="token punctuation">.</span>JobId</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
            <span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">$&quot;app/</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">ctx<span class="token punctuation">.</span>Dto<span class="token punctuation">.</span><span class="token function">GetId</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token interpolation-string"><span class="token string">$&quot;/</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">ctx<span class="token punctuation">.</span>DateSegment</span><span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">ctx<span class="token punctuation">.</span>FileName</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token named-parameter punctuation">readAccessRole</span><span class="token punctuation">:</span>RoleNames<span class="token punctuation">.</span>AllowAnon<span class="token punctuation">,</span> <span class="token named-parameter punctuation">writeAccessRole</span><span class="token punctuation">:</span>RoleNames<span class="token punctuation">.</span>AllowAnon<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="configuring-database-first-apps" tabindex="-1">Configuring Database-First Apps <a class="header-anchor" href="#configuring-database-first-apps" aria-hidden="true">#</a></h2><p>As <a href="/docs/database-first.html">Database-First Types</a> are only generated &amp; exist at runtime they can&#39;t be explicitly annotated with <code>[UploadTo]</code> attributes, instead they can be added dynamically at runtime by using AutoQuery&#39;s <code>TypeFilter</code> which is invoked for all Types including Request and Response DTO types.</p><p>An <a href="https://github.com/NetCoreApps/NorthwindAuto/blob/master/Configure.AppHost.cs" target="_blank" rel="noopener noreferrer">example of this</a> can be found in the <code>Northwind</code> Locode Database-First demo which uses <code>type.Name == &quot;Employee&quot;</code> to match on the <code>Employee</code> Data Model and <code>IsCrudCreateOrUpdate(&quot;Employee&quot;)</code> Metadata Type extension method to target its <code>CreateEmployee</code> and <code>UpdateEmployee</code> CRUD APIs:</p><div class="language-csharp"><pre><code>```<span class="token class-name">csharp</span>
TypeFilter <span class="token operator">=</span> <span class="token punctuation">(</span>type<span class="token punctuation">,</span> req<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">.</span>Name <span class="token operator">==</span> <span class="token string">&quot;Employee&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Remove embedded Blob column from Data Model Type </span>
        type<span class="token punctuation">.</span>Properties<span class="token punctuation">.</span><span class="token function">RemoveAll</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Name <span class="token operator">==</span> <span class="token string">&quot;Photo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">IsCrudCreateOrUpdate</span><span class="token punctuation">(</span><span class="token string">&quot;Employee&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Add `[Input]` and `[UploadTo]` attributes to `PhotoPath` managed file upload property</span>
        type<span class="token punctuation">.</span><span class="token function">Property</span><span class="token punctuation">(</span><span class="token string">&quot;PhotoPath&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">AddAttribute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">InputAttribute</span> <span class="token punctuation">{</span> Type <span class="token operator">=</span> Input<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>File <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">AddAttribute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">UploadToAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;employees&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The result of this is converting the Northwind Database from using the <code>Photo</code> blob column to persist image bit maps and instead uses the <code>PhotoPath</code> column to maintain an external file reference to their Profile Photo which is managed by the <code>FilesUploadFeature</code> to persist images to its configured <code>FileSystemVirtualFiles</code> virtual file source.</p></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-07c132fc><div class="edit" data-v-07c132fc><div class="edit-link" data-v-07c132fc data-v-1ed99556><a class="link" href="https://github.com/ServiceStack/docs/edit/master/docs/docs/files.md" target="_blank" rel="noopener noreferrer" data-v-1ed99556>Edit this page on GitHub <svg class="icon outbound icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-1ed99556><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="updated" data-v-07c132fc><!----></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/docs/custom-components" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>Custom Components</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/docs/auditing" data-v-38ede35f><span class="text" data-v-38ede35f>Auditing</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"docs_auditing.md\":\"485b52f1\",\"docs_branding.md\":\"fea152ac\",\"docs_code-first.md\":\"b91fe9b8\",\"docs_custom-components.md\":\"283d35f3\",\"docs_custom-forms.md\":\"a4b227d8\",\"docs_custom.md\":\"389c4f6b\",\"docs_database-first.md\":\"42eb7611\",\"docs_declarative.md\":\"06e3beb5\",\"docs_files.md\":\"7a080d34\",\"docs_formatters.md\":\"a6336ab9\",\"docs_get-started.md\":\"49b9dcbe\",\"docs_index.md\":\"2227d34a\",\"docs_input.md\":\"3cb056bc\",\"docs_programmatic.md\":\"568d5d17\",\"docs_relations.md\":\"0e210b8c\",\"index.md\":\"c823024c\",\"test.md\":\"26d28f81\"}")</script>
    <script type="module" async src="/assets/app.20eecff1.js"></script>
    
  </body>
</html>