import{_ as a,c as t,o as e,a as s,b as n}from"./app.20eecff1.js";var p="/assets/audit-history-create.7b986af6.png",o="/assets/audit-history-update.cca0cd97.png";const f='{"title":"Auditing","description":"","frontmatter":{},"headers":[{"level":2,"title":"Enabling Crud Events","slug":"enabling-crud-events"},{"level":2,"title":"Enabling Audit History Tracking on Data Models and APIs","slug":"enabling-audit-history-tracking-on-data-models-and-apis"},{"level":3,"title":"Configuring CRUD APIs","slug":"configuring-crud-apis"},{"level":2,"title":"Audit Info in Locode","slug":"audit-info-in-locode"},{"level":2,"title":"Full Executable Audit History","slug":"full-executable-audit-history"},{"level":2,"title":"Complete Bookings CRUD Implementation","slug":"complete-bookings-crud-implementation"}],"relativePath":"docs/auditing.md"}',c={},l=s(`<h1 id="auditing" tabindex="-1">Auditing <a class="header-anchor" href="#auditing" aria-hidden="true">#</a></h1><p>A benefit to AutoQuery&#39;s structured declarative approach to its CRUD APIs is that it&#39;s better able to enable high-level generic functionality that can benefit all CRUD APIs. AutoQuery CRUD&#39;s <a href="https://docs.servicestack.net/autoquery-audit-log" target="_blank" rel="noopener noreferrer">Executable Audit Log</a> is an example of this which makes use of <a href="https://docs.servicestack.net/autoquery-crud#autoquery-crud-attributes" target="_blank" rel="noopener noreferrer">AutoQuery CRUD Attributes</a> to capture every CRUD operation responsible for any modifications to its underlying RDBMS tables.</p><p>We&#39;ll explore an overview of this feature by applying it to our simple Bookings table from the <a href="https://docs.servicestack.net/autoquery-crud-bookings" target="_blank" rel="noopener noreferrer">AutoQuery CRUD Bookings Demo</a> included in all <a href="https://jamstacks.net/" target="_blank" rel="noopener noreferrer">jamstacks.net</a> project templates there by adding the ability to track all CRUD API operations and with it all modifications made to our <code>Booking</code> RDBMS table.</p><h2 id="enabling-crud-events" tabindex="-1">Enabling Crud Events <a class="header-anchor" href="#enabling-crud-events" aria-hidden="true">#</a></h2><p>First thing we need to do is register the <code>ICrudEvents</code> dependency in our App&#39;s IOC, in this case uses <code>OrmLiteCrudEvents</code> to store all Audit Information in the <code>CrudEvent</code> table of our configured database:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigureAutoQuery</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IHostingStartup</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IWebHostBuilder</span> builder<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> builder
        <span class="token punctuation">.</span><span class="token function">ConfigureServices</span><span class="token punctuation">(</span>services <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// Enable Audit History</span>
            services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ICrudEvents<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span>
                <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OrmLiteCrudEvents</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IDbConnectionFactory<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">ConfigureAppHost</span><span class="token punctuation">(</span>appHost <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            appHost<span class="token punctuation">.</span>Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutoQueryFeature</span> <span class="token punctuation">{</span>
                MaxLimit <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">,</span>
                <span class="token comment">//IncludeTotal = true,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// Create CrudEvent if it doesn&#39;t exist</span>
            appHost<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ICrudEvents<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">InitSchema</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>As <code>ICrudEvents</code> stores all events in a separate table, we also need to use <code>InitSchema</code> above to create the <code>CrudEvent</code> table if it doesn&#39;t already exist.</p><h2 id="enabling-audit-history-tracking-on-data-models-and-apis" tabindex="-1">Enabling Audit History Tracking on Data Models and APIs <a class="header-anchor" href="#enabling-audit-history-tracking-on-data-models-and-apis" aria-hidden="true">#</a></h2><p>With <code>ICrudEvents</code> registered, we can now choose which Data Models we want to enable Audit Tracking on by having them inherit from the built-in <code>AuditBase</code> class:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Booking</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">AuditBase</span></span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoIncrement</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">RoomType</span> RoomType <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> RoomNumber <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> BookingStartDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime<span class="token punctuation">?</span></span> BookingEndDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">decimal</span></span> Cost <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Notes <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span><span class="token punctuation">?</span></span> Cancelled <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This will extend our RDBMS tables with additional Audit Info to capture who and when bookings were <strong>Created</strong>, <strong>Last Modified</strong> and <strong>Deleted</strong> (when using Soft Deletes):</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AuditBase</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> CreatedDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> CreatedBy <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> ModifiedDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> ModifiedBy <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime<span class="token punctuation">?</span></span> DeletedDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> DeletedBy <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Even without needing to inspect the audit history table, capturing this info on its own provides valuable insight into the provenance of each booking.</p><h3 id="configuring-crud-apis" tabindex="-1">Configuring CRUD APIs <a class="header-anchor" href="#configuring-crud-apis" aria-hidden="true">#</a></h3><p>But to be able to maintain a complete executable audit log we need to capture every CRUD API and modification done on our <code>Booking</code> table which we can do by annotating our Booking CRUD APIs with <a href="https://docs.servicestack.net/autoquery-crud#apply-generic-crud-behaviors" target="_blank" rel="noopener noreferrer">AutoApply</a> attribute which annotates our APIs with the behavior we want to apply to them.</p><p>For the Audit feature, this behavior is implemented in the pre-registered <a href="https://docs.servicestack.net/autoquery-crud#auditautocrudmetadatafilter" target="_blank" rel="noopener noreferrer">AuditAutoCrudMetadataFilter</a> which dynamically adds attributes to annotated APIs to achieve it&#39;s desired behavior. By primarily using the <a href="https://docs.servicestack.net/autoquery-crud#autopopulate" target="_blank" rel="noopener noreferrer">[AutoPopulate]</a> attribute to populate the Audit Info and <a href="https://docs.servicestack.net/autoquery-crud#autofilter" target="_blank" rel="noopener noreferrer">[AutoFilter]</a> attribute to ensure our Query APIs don&#39;t return any <strong>Soft Deleted</strong> records.</p><p>Essentially <code>[AutoApply]</code> enables us to define a single attribute as a substitute for defining the multiple compound attributes to populate the Audit Info and Filter queries.</p><p>The appropriate <code>[AutoApply]</code> behavior needs to be added on all the CRUD APIs for the data models we want Audit History tracking enabled on, e.g:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoApply</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Behavior<span class="token punctuation">.</span>AuditQuery<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QueryBookings</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">QueryDb<span class="token punctuation">&lt;</span>Booking<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoApply</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Behavior<span class="token punctuation">.</span>AuditCreate<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CreateBooking</span>
    <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ICreateDb<span class="token punctuation">&lt;</span>Booking<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>IdResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoApply</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Behavior<span class="token punctuation">.</span>AuditModify<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UpdateBooking</span>
    <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IPatchDb<span class="token punctuation">&lt;</span>Booking<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>IdResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoApply</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Behavior<span class="token punctuation">.</span>AuditSoftDelete<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeleteBooking</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IDeleteDb<span class="token punctuation">&lt;</span>Booking<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IReturnVoid</span></span>
<span class="token punctuation">{</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Use <code>Behavior.AuditDelete</code> instead if you prefer your delete operations resulted in permanent hard deletes</p></div><h2 id="audit-info-in-locode" tabindex="-1">Audit Info in Locode <a class="header-anchor" href="#audit-info-in-locode" aria-hidden="true">#</a></h2><p>The <code>AutoQueryFeature.AccessRole</code> determines the accessibility of the CRUD Event APIs that Locode uses to display the Audit History logs for each entity, which by default is restricted to <strong>Admin</strong> users who will be able to view the Audit History of each record at the bottom of its <strong>Edit</strong> Form.</p><p>With our Bookings CRUD APIs now configured with Audit behavior we can see an example of what this looks like in Locode after the Employee User account records a Booking from <strong>John Smith</strong> for a <strong>Single</strong> room:</p><p><img src="`+p+'" alt=""></p><p>With the left section displaying audit information about the CRUD operation and the User making it including their UserName, Id and IP. The right section contains the info sent in the Request DTO, in this case the <code>CreateBooking</code> API.</p><p>If <strong>John Smith</strong> later contacts the manager to upgrade his booking to a <strong>Suite</strong>, the Audit information will be updated with the <code>UpdateBooking</code> Audit entry which as it is a <code>IPatchDb&lt;Table&gt;</code> operation, only contains information that&#39;s <strong>changed</strong>:</p><p><img src="'+o+`" alt=""></p><p>This is typically why the behavior of <code>IPatchDb&lt;Table&gt;</code> is preferable over <code>IUpdateDb&lt;Table&gt;</code> APIs when Audit Tracking is enabled as otherwise each Update operation would instead contain the entire entry on each update.</p><h2 id="full-executable-audit-history" tabindex="-1">Full Executable Audit History <a class="header-anchor" href="#full-executable-audit-history" aria-hidden="true">#</a></h2><p>As each Audit Entry contains the CRUD Request DTO, they can be used to recreate the state of the database by replaying each event &amp; executing them against a blank database:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> eventsPlayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CrudEventsExecutor</span><span class="token punctuation">(</span>appHost<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> crudEvent <span class="token keyword">in</span> dbEvents<span class="token punctuation">.</span><span class="token function">GetEvents</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">await</span> eventsPlayer<span class="token punctuation">.</span><span class="token function">ExecuteAsync</span><span class="token punctuation">(</span>crudEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This can provide similar benefits to <a href="https://martinfowler.com/eaaDev/EventSourcing.html" target="_blank" rel="noopener noreferrer">Event Sourcing</a> without its additional development &amp; maintenance burden where they can be used to reconstruct the state of the database at a specific point in time or used to populate external data stores like search indexes or analytical reporting databases to enable greater insight than what an RDBMS snapshot can provide.</p><p>You could replay all events to reconstruct the entire state of the database, or choose just the tables you want to rebuild where you can fetch all Audit Events for just the <code>Booking</code> table with:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> bookingAuditEvents <span class="token operator">=</span> dbEvents<span class="token punctuation">.</span><span class="token function">GetEvents</span><span class="token punctuation">(</span>Db<span class="token punctuation">,</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>Booking<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Alternatively you can fetch all the audit events for a single row which is what Locode uses to display its Audit Events:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> rowAuditEvents <span class="token operator">=</span> dbEvents<span class="token punctuation">.</span><span class="token function">GetEvents</span><span class="token punctuation">(</span>Db<span class="token punctuation">,</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>Booking<span class="token punctuation">)</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="complete-bookings-crud-implementation" tabindex="-1">Complete Bookings CRUD Implementation <a class="header-anchor" href="#complete-bookings-crud-implementation" aria-hidden="true">#</a></h2><p>The <a href="https://docs.servicestack.net/autoquery-crud-bookings" target="_blank" rel="noopener noreferrer">Bookings CRUD Demo</a> is a good representative example of the effort it takes to implement a traditional CRUD API with AutoQuery:</p>`,38),u=n("div",{class:"relative"},[n("div",{class:"max-w-7xl mx-auto px-4 sm:px-6 pb-4"},[n("div",{class:"aspect-w-16 aspect-h-9"},[n("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/nhc4MZufkcM",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""})])])],-1),i=s(`<p>Which reduces the development to effort of creating Full Stack Apps down to declaring your Data Models and APIs with simple POCOs to define the precise schema of the underlying RDBMS tables and API contract, that can then benefit from:</p><ul><li>Productive end-to-end <a href="https://servicestack.net/service-reference" target="_blank" rel="noopener noreferrer">typed Development Model in 9 languages</a></li><li><a href="/docs/declarative.html">Declarative Dev Model</a> for defining Authentication, Validation, Documentation &amp; UI Customizations</li><li>Beautiful, UX-Friendly, capability-based Customizable UI in <a href="https://locode.dev" target="_blank" rel="noopener noreferrer">Locode</a></li><li>Rich analysis, API discoverability &amp; <a href="https://docs.servicestack.net/api-explorer#code-tab" target="_blank" rel="noopener noreferrer">simplified client integrations</a> in <a href="https://docs.servicestack.net/api-explorer" target="_blank" rel="noopener noreferrer">API Explorer</a></li><li>Powerful querying capabilities in <a href="https://docs.servicestack.net/autoquery" target="_blank" rel="noopener noreferrer">AutoQuery</a></li><li>Full executable <a href="https://docs.servicestack.net/autoquery-audit-log" target="_blank" rel="noopener noreferrer">Audit History Tracking</a></li><li>Access to ServiceStack&#39;s rich ecosystem of <a href="https://docs.servicestack.net/why-servicestack#multiple-clients" target="_blank" rel="noopener noreferrer">typed clients, versatile formats &amp; endpoints</a></li><li>Seamless integrations with <a href="https://docs.servicestack.net/openapi" target="_blank" rel="noopener noreferrer">Open API</a>, interactive <a href="https://docs.servicestack.net/jupyter-notebooks" target="_blank" rel="noopener noreferrer">Jupyter Notebooks</a> &amp; <a href="https://apps.servicestack.net/" target="_blank" rel="noopener noreferrer">Instant Client Apps</a></li></ul><p>And access to ServiceStack&#39;s rich ecosystem of features, most of which are centered around your typed API contracts making them easy to enhance &amp; apply to your existing Services.</p><p>All without needing to write a single line of implementation logic thanks to the default implementation in AutoQuery Services &amp; Auto UIs in Locode, API Explorer &amp; Swagger UI. At the same time when needed the default behavior can be overridden at multiple levels, from custom AutoQuery implementations on the server to custom UIs on the client.</p><p>For completeness, the entire code base used to implement the Bookings CRUD implementation is below:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Booking</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">AuditBase</span></span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoIncrement</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">RoomType</span> RoomType <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> RoomNumber <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> BookingStartDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime<span class="token punctuation">?</span></span> BookingEndDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">decimal</span></span> Cost <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Notes <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span><span class="token punctuation">?</span></span> Cancelled <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">RoomType</span>
<span class="token punctuation">{</span>
    Single<span class="token punctuation">,</span>
    Double<span class="token punctuation">,</span>
    Queen<span class="token punctuation">,</span>
    Twin<span class="token punctuation">,</span>
    Suite<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoApply</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Behavior<span class="token punctuation">.</span>AuditQuery<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QueryBookings</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">QueryDb<span class="token punctuation">&lt;</span>Booking<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> Ids <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateHasRole</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;Employee&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoApply</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Behavior<span class="token punctuation">.</span>AuditCreate<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CreateBooking</span>
    <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ICreateDb<span class="token punctuation">&lt;</span>Booking<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>IdResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">RoomType</span> RoomType <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateGreaterThan</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> RoomNumber <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> BookingStartDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime<span class="token punctuation">?</span></span> BookingEndDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateGreaterThan</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">decimal</span></span> Cost <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Notes <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateHasRole</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;Employee&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoApply</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Behavior<span class="token punctuation">.</span>AuditModify<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UpdateBooking</span>
    <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IPatchDb<span class="token punctuation">&lt;</span>Booking<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>IdResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">RoomType<span class="token punctuation">?</span></span> RoomType <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateGreaterThan</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> RoomNumber <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime<span class="token punctuation">?</span></span> BookingStartDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime<span class="token punctuation">?</span></span> BookingEndDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateGreaterThan</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">decimal</span><span class="token punctuation">?</span></span> Cost <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span><span class="token punctuation">?</span></span> Cancelled <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Notes <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateHasRole</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;Manager&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoApply</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Behavior<span class="token punctuation">.</span>AuditSoftDelete<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeleteBooking</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IDeleteDb<span class="token punctuation">&lt;</span>Booking<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IReturnVoid</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>`,6),k=[l,u,i];function r(d,y,g,m,h,b){return e(),t("div",null,k)}var v=a(c,[["render",r]]);export{f as __pageData,v as default};
